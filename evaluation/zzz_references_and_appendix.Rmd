```{r references, results = "asis", echo = FALSE}
# insert the references at this position
# set appendix = FALSE, when the report has no appendix
INBOmd::references(appendix = TRUE)
```

# Habitat types and subtypes in Flanders {#annex1}

```{r}

subtype_names <- read_types() %>%
  filter(typelevel == "subtype") %>%
  distinct(main_type, type, type_name) %>%
  rename(subtype = type, subtype_name = type_name)

main_types_names <- read_types() %>%
  filter(typelevel == "main_type") %>%
  distinct(typeclass_name, main_type, type_name)
  
table_types <- main_types_names %>%
  filter(!str_detect(main_type, "rbb")) %>%
  left_join(subtype_names, by = "main_type")

table_types %>%
  mutate(type_name = str_c(type_name, " (", main_type,")"),
         subtype_name = str_c(subtype_name, " (", subtype, ")")) %>%
  select("habitat category" = typeclass_name, "habitat type" = type_name, "habitat subtype" = subtype_name) %>%
  kable(booktabs = TRUE,
        longtable = TRUE,
        caption = "Habitat types and subtypes in Flanders", 
        format = format_table) %>%
  kable_styling(latex_options = c("scale_down")) %>%
    column_spec(1, width = "0.5cm") %>%
    column_spec(c(2,3), width = "7cm") %>%
    collapse_rows(c(1, 2), row_group_label_position = 'stack')
  
```

# Power calculations using the `simr` package {#annexsimr}

## Methdodolgy

In a first step we use existing data from the Flemish Forest Inventory to fit a generalized linear mixed models, with plot as random effect to specify that the observations are paired. Next, model assumptions can be verified using the function `plotQQunif` of the `DHARMa` package [@hartig2022].  

## Trend in proportion of favourable indicators for habitat type 9120

The following R code models the proportion of favourable indicators (prop_favourable) for the different Forest Inventory periods using plot as a random effect:

`model_9120 <- lmer(formula = prop_favourable ~ period + (1|plot), data = data_forest_paired)`

The model assumptions are quite OK as can be seen in the figure below.

```{r}
plotQQunif(model_9120)
```
Table \@ref(tab:tabcompsimr1)

```{r tabcompsimr1}

compare_power_aandeel_gunstig_9210 %>%
  mutate(ci = str_c("[", round(lcl, 2), " - ", round(ucl, 2), "]")) %>%
  select("sample size" = n, "detectable effect size (paired t-test)" = effect_size, "power (simr)" = power_simr, "95\\% confidence interval" = ci) %>%
  kable(caption = "Estimated power based on simr package and 95\\% confidence interval", 
        digits = 2) %>%
  kable_styling()
```




# Habitat types and subtypes included in MHQ {#annex2} 

Table \@ref(tab:tabschemes) gives an overview of the habitat types for which a habitat quality monitoring scheme was developed. The table also provides the reason why a monitoring scheme was not considered the most appropriate approach for several habitat types. Terrestrial habitat types are considered very rare when the area is lower than 10 ha or when the habitat type occurs on less than 15 locations. The area and the number of locations was derived from the 2020 version of the Natura 2000 Habitat map [@inbo2020].   

```{r tabschemes}

maintype_selection <- types_area_strata %>%
  mutate(area = round(area_type),
         sample_type = ifelse(sample_type, "yes", "no"),
         reden = ifelse(main_type %in% c("1310", "2110", "3270", "7150"), "very dynamic habitat type",
                        ifelse(main_type %in% c("1140"), "no habitat quality indicators available",
                               ifelse(main_type %in% c("1130"), "habitat quality evaluation on landsacpe scale",
                                      ifelse(main_type %in% c("6430"), "no accurate sample frame", 
                                             ifelse(main_type %in% c("9110"), "low priority", 
                                             ifelse(sample_type == "no" & (area <= 10 | n_polygons <= 15) , "very rare terrestrial type", ""))))))) %>%
  select("code type" = main_type, "area (ha)" = area,  "# locations" = n_polygons, "monitoring scheme" = sample_type, "reason" = reden) %>%
  unique()
  
maintype_selection %>%
  kable(caption = "Selection of the habitat types for which a monitoring scheme is implemented",
        booktabs = TRUE,
        longtable = TRUE, 
        format = format_table) %>%
  kable_styling(latex_options = c("repeat_header")) %>%
  column_spec(c(1,4), width = "1.5cm")

```




Table \@ref(tab:tabschemes2) gives an overview of which habitat subtypes are considered for oversampling. 

```{r tabschemes2}
subtype_selection <- types_area_strata %>%
  filter(typelevel == "subtype") %>%
  filter(sample_type) %>%
  mutate(area = round(area_subtype),
         extra_subtype = ifelse(extra_subtype, "yes", "no"),
         reason = ifelse(extra_subtype == "no" & (area <= 10 | n_polygons <= 15) , "very rare terrestrtial subtype", "")) %>%
  select("code type " = main_type,"code subtype" = type, "area (ha)" = area,  "# locations" = n_polygons_subtype, "oversampling" = extra_subtype, reason) %>%
  unique() 
  
subtype_selection %>%
  kable(caption = "Oversampling habitat subtypes",
        booktabs = TRUE, 
        format = format_table) %>%
  kable_styling() %>%
  collapse_rows(1)
```


# Sample size per habitat type and subtype {#annex3} 

Table \@ref(tab:tabsamplesizeterr) provides an overview per habitat type of:

+ total initial sample size for Flanders ($tot_{fl}$)
+ number of extra sampling units selected within the SAC ($extra_{sac}$)
+ number of extra sampling units selected per subtype ($extra_{subtype}$)
+ total overall sample size for the monitoring cycle
+ total overall sample size per year



```{r tabsamplesizeterr, eval=TRUE}

scenarios_subtype <- scenarios %>%
  filter(type_cat == "forest type" | scenario == "alternative 3") %>%
  filter(typelevel == "subtype", ) %>%
  select(main_type, subtype = type, n_extra_subtypes)

scenarios_main_type %>%
  filter(type_cat == "forest type" | scenario == "alternative 3") %>%
  arrange(main_type) %>%
  select("habitat type" = main_type, "cycle (years)" = cycle_years,  "tot fl" =  n_finite_flanders, "extra sac" =  n_extra_sac,  "extra subtype" =  n_extra_subtypes, "total per cycle" = n_total, "total per year" = n_total_year) %>%
  kable(booktabs = TRUE,
        caption = "Sample size per habitat type",
        align = "lccclccc",
        longtable = TRUE, 
        format = format_table) %>%
  kable_styling(latex_options = c("repeat_header")) %>%
  column_spec(c(1, 2, 3, 4), width = "1cm") %>%
  column_spec(c(5, 6, 7), width = "1.5cm") 
```


Table \@ref(tab:tabsamplesizeterrst) shows the number of extra sampling units per habitat subtype.

```{r tabsamplesizeterrst}
scenarios_subtype %>%
  arrange(main_type) %>%
  semi_join(scenarios_main_type, by = "main_type") %>%
  select("habitat type" = main_type, subtype,  "extra subtype" =  n_extra_subtypes) %>%
  kable(booktabs = TRUE,
        caption = "number of extra sampling units per habitat subtype", 
        format = format_table) %>%
  kable_styling() %>%
  collapse_rows(1)
```

